DROP DATABASE IF EXISTS `lead`;
CREATE DATABASE IF NOT EXISTS `lead` DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_bin;

USE `lead`;

SET default_storage_engine=INNODB;

CREATE TABLE IF NOT EXISTS `hash`(
    `id` INT PRIMARY KEY,
    `k` VARCHAR(16) UNIQUE KEY
);

CREATE TABLE IF NOT EXISTS `user`(
    `id` SERIAL PRIMARY KEY,
    `un` VARCHAR(16) NOT NULL,
    `sess` VARCHAR(32) NOT NULL,
    `s` TINYINT UNSIGNED DEFAULT 1,
    `uby` BIGINT UNSIGNED,
    `uat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `cby` BIGINT UNSIGNED NOT NULL,
    `cat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY (`un`),
    KEY (`sess`),
    KEY (`uat`),
    KEY (`cby`)
);

CREATE TABLE IF NOT EXISTS `userMap`(
    `id` SERIAL PRIMARY KEY,
    `userId` BIGINT UNSIGNED NOT NULL,
    `k` INT NOT NULL,
    `v1` TEXT,
    `v2` INT,
    `uby` BIGINT UNSIGNED,
    `uat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `cby` BIGINT UNSIGNED NOT NULL,
    `cat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY (`userId`, `k`)
);

CREATE TABLE IF NOT EXISTS `userList`(
    `id` SERIAL PRIMARY KEY,
    `userId` BIGINT UNSIGNED NOT NULL,
    `k` INT NOT NULL,
    `v1` TEXT,
    `v2` INT,
    `s` TINYINT UNSIGNED DEFAULT 1,
    `uby` BIGINT UNSIGNED,
    `uat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `cby` BIGINT UNSIGNED NOT NULL,
    `cat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    KEY (`userId`, `k`)
);

CREATE TABLE IF NOT EXISTS `device`(
    `id` SERIAL PRIMARY KEY,
    `userId` BIGINT UNSIGNED NOT NULL,
    `s` TINYINT UNSIGNED DEFAULT 1,
    `uby` BIGINT UNSIGNED,
    `uat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `cby` BIGINT UNSIGNED NOT NULL,
    `cat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    KEY (`userId`),
    KEY (`uat`),
    KEY (`cby`)
);

CREATE TABLE IF NOT EXISTS `deviceMap`(
    `id` SERIAL PRIMARY KEY,
    `deviceId` BIGINT UNSIGNED NOT NULL,
    `k` INT NOT NULL,
    `v1` TEXT,
    `v2` INT,
    `uby` BIGINT UNSIGNED,
    `uat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `cby` BIGINT UNSIGNED NOT NULL,
    `cat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY (`deviceId`, `k`)
);

CREATE TABLE IF NOT EXISTS `lock`(
    `id` SERIAL PRIMARY KEY,
    `placeId` BIGINT UNSIGNED NOT NULL,
    `name` VARCHAR(32),
    `s` TINYINT UNSIGNED DEFAULT 1,
    `uby` BIGINT UNSIGNED,
    `uat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `cby` BIGINT UNSIGNED NOT NULL,
    `cat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    KEY (`placeId`,`name`),
    KEY (`uat`),
    KEY (`cby`)
);

CREATE TABLE IF NOT EXISTS `lockMap`(
    `id` SERIAL PRIMARY KEY,
    `placeId` BIGINT UNSIGNED NOT NULL,
    `k` INT NOT NULL,
    `v1` TEXT,
    `v2` INT,
    `uby` BIGINT UNSIGNED,
    `uat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `cby` BIGINT UNSIGNED NOT NULL,
    `cat` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY (`placeId`, `k`)
);
